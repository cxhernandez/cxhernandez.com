<section id="Photography" class="parallax">
    <div class="section-header-rotate">
        <h2>Photography</h2>
    </div>
    <div class="container">
        <div class="row-fluid">
            <div class="photo-carousel">
                <button class="carousel-btn carousel-prev" onclick="moveCarousel(-1)">&#10094;</button>

                <div class="carousel-container">
                    <div class="carousel-track" id="carouselTrack">
                        <!-- Photos will be loaded dynamically from Behold -->
                    </div>
                </div>

                <button class="carousel-btn carousel-next" onclick="moveCarousel(1)">&#10095;</button>
            </div>

            <div class="carousel-dots" id="carouselDots"></div>

            <p style="color:rgba(0,0,0,0.6); text-align:center; margin-top:2em; font-size:0.9em;">
                <a href="https://www.instagram.com/cxhrndz/" target="_blank" style="color:#2a7ae2;">View more on Instagram →</a>
            </p>
        </div>
    </div>
</section>

<script>
  // Behold Instagram Feed
  const BEHOLD_FEED_ID = 'Kle1PsrNxibbk5uPAkom';

  let currentSlide = 0;
  let totalSlides = 0;

  async function loadInstagramFeed() {
    const track = document.getElementById('carouselTrack');
    const dotsContainer = document.getElementById('carouselDots');

    try {
      // Fetch from Behold API
      const response = await fetch(`https://feeds.behold.so/${BEHOLD_FEED_ID}`);
      const data = await response.json();

      // Get the latest 10 posts (posts are in data.posts array)
      const posts = data.posts.slice(0, 10);
      totalSlides = posts.length;

      // Create slides
      posts.forEach((post, index) => {
        const slide = document.createElement('div');
        slide.className = 'carousel-slide';

        const link = document.createElement('a');
        link.href = post.permalink;
        link.target = '_blank';
        link.rel = 'noopener';

        const img = document.createElement('img');
        img.src = post.mediaUrl;
        img.alt = post.caption ? post.caption.substring(0, 100) : 'Instagram photo';
        img.loading = index === 0 ? 'eager' : 'lazy';

        link.appendChild(img);
        slide.appendChild(link);
        track.appendChild(slide);

        // Create dot
        const dot = document.createElement('span');
        dot.className = 'carousel-dot' + (index === 0 ? ' active' : '');
        dot.onclick = () => goToSlide(index);
        dotsContainer.appendChild(dot);
      });

      // Start auto-advance
      setInterval(() => moveCarousel(1), 5000);

    } catch (error) {
      console.error('Error loading Instagram feed:', error);
      track.innerHTML = '<div class="carousel-slide"><p style="color:white; text-align:center;">Unable to load Instagram feed. <a href="https://www.instagram.com/cxhrndz/" style="color:#E1306C;">Visit Instagram →</a></p></div>';
    }
  }

  function updateCarousel() {
    const track = document.getElementById('carouselTrack');
    track.style.transform = `translateX(-${currentSlide * 100}%)`;
    document.querySelectorAll('.carousel-dot').forEach((dot, i) => {
      dot.className = 'carousel-dot' + (i === currentSlide ? ' active' : '');
    });
  }

  function moveCarousel(direction) {
    if (totalSlides === 0) return;
    currentSlide = (currentSlide + direction + totalSlides) % totalSlides;
    updateCarousel();
  }

  function goToSlide(index) {
    currentSlide = index;
    updateCarousel();
  }

  // Load feed when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', loadInstagramFeed);
  } else {
    loadInstagramFeed();
  }
</script>

---
layout: default
---

<section id="Store" class="parallax">
    <div class="container">
        <div class="row-fluid">
            <div class="store-content span12">
                <div class="store-intro">
                    <p>Purchase prints of my photography or book a portrait session.</p>
                </div>

                <!-- Success Message -->
                <div id="success-message" class="success-banner" style="display: none;">
                    <p>Thank you for your purchase! You'll receive a confirmation email shortly.</p>
                </div>

                <div class="store-sections">
                    <!-- Prints Section -->
                    <div class="store-section">
                        <h3>Prints</h3>
                        <p class="section-description">High-quality prints of my wildlife and street photography, professionally printed on archival paper.</p>

                        <div class="product-grid" id="prints-grid">
                            <div class="loading-placeholder">Loading prints...</div>
                        </div>
                    </div>

                    <!-- Services Section -->
                    <div class="store-section">
                        <h3>Photography Services</h3>
                        <p class="section-description">Book a portrait session for professional headshots, family photos, or special occasions.</p>

                        <div class="services-grid" id="services-grid">
                            <div class="service-card">
                                <div class="service-icon">üì∏</div>
                                <h4>Portrait Session</h4>
                                <p>1-hour professional portrait session at a location of your choice. Includes 10 edited digital photos and a print of your choice.</p>
                                <p class="price">$250</p>
                                <button class="btn-book" data-name="Portrait Session" data-price="25000">Book Now</button>
                            </div>

                            <div class="service-card">
                                <div class="service-icon">üêæ</div>
                                <h4>Pet Portrait Session</h4>
                                <p>Capture your furry friend's personality in a 1-hour session. Includes 10 edited digital photos and a print of your choice.</p>
                                <p class="price">$200</p>
                                <button class="btn-book" data-name="Pet Portrait Session" data-price="20000">Book Now</button>
                            </div>

                        </div>
                    </div>
                </div>

                <div class="store-outro">
                    <p><a href="/#Photography" class="back-link">&larr; Back</a></p>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    const WORKER_URL = '{{ site.square.worker_url }}';

    // Check for success parameter in URL
    function checkForSuccess() {
        const params = new URLSearchParams(window.location.search);
        if (params.get('success') === 'true') {
            document.getElementById('success-message').style.display = 'block';
            // Clean up URL
            window.history.replaceState({}, '', window.location.pathname);
        }
    }

    // Redirect to Square hosted checkout
    async function checkout(name, price) {
        try {
            const response = await fetch(`${WORKER_URL}/checkout`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name, price })
            });

            const data = await response.json();

            if (data.success && data.checkoutUrl) {
                window.location.href = data.checkoutUrl;
            } else {
                alert('Failed to create checkout. Please try again.');
                console.error('Checkout error:', data.error);
            }
        } catch (error) {
            alert('Failed to create checkout. Please try again.');
            console.error('Checkout error:', error);
        }
    }

    // Load prints from Square catalog
    async function loadPrints() {
        const grid = document.getElementById('prints-grid');

        try {
            const response = await fetch(`${WORKER_URL}/catalog`);
            const data = await response.json();

            if (!data.success || !data.items || data.items.length === 0) {
                grid.innerHTML = '<p class="no-prints">No prints available at this time.</p>';
                return;
            }

            grid.innerHTML = data.items.map(item => {
                const variation = item.variations[0] || {};
                const price = variation.price || 0;
                const priceDisplay = (price / 100).toFixed(2);
                const imageUrl = item.images[0] || '/static/img/placeholder.jpg';

                return `
                    <div class="product-card">
                        <div class="product-image">
                            <img src="${imageUrl}" alt="${item.name}" loading="lazy">
                        </div>
                        <div class="product-info">
                            <h4>${item.name}</h4>
                            ${item.description ? `<p>${item.description}</p>` : ''}
                            <p class="price">$${priceDisplay}</p>
                            <button class="btn-buy" data-name="${item.name}" data-price="${price}">
                                Buy Print
                            </button>
                        </div>
                    </div>
                `;
            }).join('');

            // Bind click handlers to buy buttons
            grid.querySelectorAll('.btn-buy').forEach(btn => {
                btn.addEventListener('click', function() {
                    const name = this.dataset.name;
                    const price = parseInt(this.dataset.price, 10);
                    checkout(name, price);
                });
            });
        } catch (error) {
            console.error('Failed to load prints:', error);
            grid.innerHTML = '<p class="error">Failed to load prints. Please try again later.</p>';
        }
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
        checkForSuccess();
        loadPrints();

        // Bind click handlers to service booking buttons
        document.querySelectorAll('.btn-book').forEach(btn => {
            btn.addEventListener('click', function() {
                const name = this.dataset.name;
                const price = parseInt(this.dataset.price, 10);
                checkout(name, price);
            });
        });
    });
</script>

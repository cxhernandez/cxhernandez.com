---
layout: default
---

<!-- Checkout Modal -->
<div id="checkout-modal" class="checkout-modal" style="display: none;">
    <div class="checkout-modal-backdrop"></div>
    <div class="checkout-modal-content">
        <button class="checkout-modal-close" aria-label="Close">&times;</button>
        <iframe id="checkout-iframe" src="" frameborder="0"></iframe>
    </div>
</div>

<style>
    .checkout-modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 9999;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .checkout-modal-backdrop {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
    }
    .checkout-modal-content {
        position: relative;
        width: 80%;
        height: 80%;
        max-height: 700px;
        background: #fff;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }
    .checkout-modal-close {
        position: absolute;
        top: 10px;
        right: 10px;
        width: 36px;
        height: 36px;
        border: none;
        background: rgba(0, 0, 0, 0.1);
        border-radius: 50%;
        font-size: 24px;
        line-height: 1;
        cursor: pointer;
        z-index: 10;
        color: #333;
        transition: background 0.2s;
    }
    .checkout-modal-close:hover {
        background: rgba(0, 0, 0, 0.2);
    }
    #checkout-iframe {
        width: 100%;
        height: 100%;
        border: none;
    }
</style>

<section id="Store" class="parallax">
    <div class="container">
        <div class="row-fluid">
            <div class="store-content span12">
                <div class="store-intro">
                    <p>Purchase prints of my photography or book a portrait session.</p>
                </div>

                <!-- Success Message -->
                <div id="success-message" class="success-banner" style="display: none;">
                    <p>Thank you for your purchase! You'll receive a confirmation email shortly.</p>
                </div>

                <div class="store-sections">
                    <!-- Prints Section -->
                    <div class="store-section">
                        <h3>Prints</h3>
                        <p class="section-description">High-quality prints of my wildlife and street photography, professionally printed on archival paper.</p>

                        <div class="product-grid" id="prints-grid">
                            <div class="loading-placeholder">Loading prints...</div>
                        </div>
                    </div>

                    <!-- Services Section -->
                    <div class="store-section">
                        <h3>Photography Services</h3>
                        <p class="section-description">Book a portrait session for professional headshots, family photos, or special occasions.</p>

                        <div class="services-grid" id="services-grid">
                            <div class="loading-placeholder">Loading services...</div>
                        </div>
                    </div>
                </div>

                <div class="store-outro">
                    <p><a href="/#Photography" class="back-link">&larr; Back</a></p>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    // Modal functions
    function openCheckoutModal(url) {
        const modal = document.getElementById('checkout-modal');
        const iframe = document.getElementById('checkout-iframe');
        iframe.src = url;
        modal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
    }

    function closeCheckoutModal() {
        const modal = document.getElementById('checkout-modal');
        const iframe = document.getElementById('checkout-iframe');
        modal.style.display = 'none';
        iframe.src = '';
        document.body.style.overflow = '';
    }

    // Check for success parameter in URL
    function checkForSuccess() {
        const params = new URLSearchParams(window.location.search);
        if (params.get('success') === 'true') {
            document.getElementById('success-message').style.display = 'block';
            // Clean up URL
            window.history.replaceState({}, '', window.location.pathname);
        }
    }

    // Render a product card (Square embed style)
    function renderProductCard(entry, index, type) {
        const url = entry.url || '#';
        const name = entry.name || `${type} ${index + 1}`;
        const image = entry.image || '';
        const price = entry.price_display || '';
        const description = entry.description || '';
        const icon = entry.icon || '';

        return `
            <div style="overflow: auto; display: flex; flex-direction: column; justify-content: flex-end; align-items: center; width: 259px; background: #FFFFFF; border: 1px solid rgba(0, 0, 0, 0.1); box-shadow: -2px 10px 5px rgba(0, 0, 0, 0); border-radius: 10px; font-family: SQ Market, SQ Market, Helvetica, Arial, sans-serif;">
                ${image ? `<img src="${image}" alt="${name}" onerror="this.style.display='none'" style="width: 100%;">` : ''}
                <div style="padding: 20px; text-align: center;">
                    ${icon ? `<div style="font-size: 32px; margin-bottom: 10px;">${icon}</div>` : ''}
                    <p style="font-size: 18px; line-height: 20px; font-weight: 600;">${name}</p>
                    ${description ? `<p style="font-size: 14px; line-height: 18px; color: #666; margin: 10px 0;">${description}</p>` : ''}
                    ${price ? `<p style="font-size: 18px; line-height: 20px; font-weight: 600; margin-bottom: 15px;">${price}</p>` : ''}
                    <a href="${url}" onclick="openCheckoutModal('${url}'); return false;" style="display: inline-block; font-size: 18px; line-height: 48px; height: 48px; color: #ffffff; min-width: 212px; background-color: #006aff; text-align: center; box-shadow: 0 0 0 1px rgba(0,0,0,.1) inset; border-radius: 6px; text-decoration: none; cursor: pointer;">${type === 'Service' ? 'Book Now' : 'Buy Now'}</a>
                </div>
            </div>
        `;
    }

    // Load inventory from local JSON and render
    async function loadInventory() {
        const printsGrid = document.getElementById('prints-grid');
        const servicesGrid = document.getElementById('services-grid');

        try {
            // Add cache-busting parameter
            const response = await fetch('/static/files/store/inventory.json?v=' + Date.now());
            if (!response.ok) {
                printsGrid.innerHTML = '<p class="no-prints">No prints available at this time.</p>';
                servicesGrid.innerHTML = '<p class="no-services">No services available at this time.</p>';
                return;
            }

            const data = await response.json();

            // Render prints
            if (data.prints && data.prints.length > 0) {
                printsGrid.innerHTML = data.prints.map((p, i) => {
                    const entry = (typeof p === 'string') ? { url: p } : p || {};
                    return renderProductCard(entry, i, 'Print');
                }).join('');
            } else {
                printsGrid.innerHTML = '<p class="no-prints">No prints available at this time.</p>';
            }

            // Render services
            if (data.services && data.services.length > 0) {
                servicesGrid.innerHTML = data.services.map((s, i) => {
                    const entry = (typeof s === 'string') ? { url: s } : s || {};
                    return renderProductCard(entry, i, 'Service');
                }).join('');
            } else {
                servicesGrid.innerHTML = '<p class="no-services">No services available at this time.</p>';
            }
        } catch (error) {
            console.error('Failed to load inventory:', error);
            printsGrid.innerHTML = '<p class="error">Failed to load prints. Please try again later.</p>';
            servicesGrid.innerHTML = '<p class="error">Failed to load services. Please try again later.</p>';
        }
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
        checkForSuccess();
        loadInventory();

        // Modal close handlers
        document.querySelector('.checkout-modal-close').addEventListener('click', closeCheckoutModal);
        document.querySelector('.checkout-modal-backdrop').addEventListener('click', closeCheckoutModal);
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeCheckoutModal();
            }
        });
    });
</script>

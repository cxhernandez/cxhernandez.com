---
layout: default
---

<!-- Password Protection -->
<div id="password-gate" class="password-gate">
    <div class="password-gate-wrapper">
        <div class="password-gate-content">
            <h2>Coming Soon...</h2>
            <form id="password-form" onsubmit="return checkPassword(event)">
                <input type="password" id="password-input" placeholder="Enter password" autocomplete="off">
            </form>
            <p id="password-error" class="password-error" style="display: none;">Incorrect password</p>
        </div>
        <p class="password-gate-back"><a href="/#Photography" class="back-link">&larr; Back</a></p>
    </div>
</div>

<!-- Checkout Modal -->
<div id="checkout-modal" class="checkout-modal" style="display: none;">
    <div class="checkout-modal-backdrop"></div>
    <div class="checkout-modal-content">
        <button class="checkout-modal-close" aria-label="Close">&times;</button>
        <iframe id="checkout-iframe" src="" frameborder="0"></iframe>
    </div>
</div>

<div id="store-main" style="display: none;">
<section id="Store" class="parallax">
    <div class="container">
        <div class="row-fluid">
            <div class="store-content span12">
                <div class="store-intro">
                    <p>Purchase prints of my photography or book a portrait session.</p>
                </div>

                <!-- Success Message -->
                <div id="success-message" class="success-banner" style="display: none;">
                    <p>Thank you for your purchase! You'll receive a confirmation email shortly.</p>
                </div>

                <div class="store-sections">
                    <!-- Prints Section -->
                    <div class="store-section">
                        <h3>Prints</h3>
                        <p class="section-description">High-quality prints of my wildlife and street photography, professionally printed on archival paper.</p>

                        <div class="product-grid" id="prints-grid">
                            <div class="loading-placeholder">Loading prints...</div>
                        </div>
                    </div>

                    <!-- Services Section -->
                    <div class="store-section">
                        <h3>Photography Services</h3>
                        <p class="section-description">Book a portrait session for professional headshots, family photos, or special occasions.</p>

                        <div class="services-grid" id="services-grid">
                            <div class="loading-placeholder">Loading services...</div>
                        </div>
                    </div>
                </div>

                <div class="store-outro">
                    <p><a href="/#Photography" class="back-link">&larr; Back</a></p>
                </div>
            </div>
        </div>
    </div>
</section>
</div>

<script>
    // Password protection (SHA-256 hash)
    const STORE_PASSWORD_HASH = '83006a438f94daf3a7dd9c7b27f70c15e443c0ca55d58fcdfa76899ae466b455';

    async function hashPassword(password) {
        const encoder = new TextEncoder();
        const data = encoder.encode(password);
        const hashBuffer = await crypto.subtle.digest('SHA-256', data);
        const hashArray = Array.from(new Uint8Array(hashBuffer));
        return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
    }

    async function checkPassword(e) {
        e.preventDefault();
        const input = document.getElementById('password-input');
        const error = document.getElementById('password-error');

        const inputHash = await hashPassword(input.value);
        if (inputHash === STORE_PASSWORD_HASH) {
            sessionStorage.setItem('store_access', 'granted');
            document.getElementById('password-gate').style.display = 'none';
            document.getElementById('store-main').style.display = 'block';
        } else {
            error.style.display = 'block';
            input.value = '';
            input.focus();
        }
        return false;
    }

    function checkAccess() {
        if (sessionStorage.getItem('store_access') === 'granted') {
            document.getElementById('password-gate').style.display = 'none';
            document.getElementById('store-main').style.display = 'block';
        }
    }

    // Modal functions
    function openCheckoutModal(url) {
        const modal = document.getElementById('checkout-modal');
        const iframe = document.getElementById('checkout-iframe');
        iframe.src = url;
        modal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
    }

    function closeCheckoutModal() {
        const modal = document.getElementById('checkout-modal');
        const iframe = document.getElementById('checkout-iframe');
        modal.style.display = 'none';
        iframe.src = '';
        document.body.style.overflow = '';
    }

    // Check for success parameter in URL
    function checkForSuccess() {
        const params = new URLSearchParams(window.location.search);
        if (params.get('success') === 'true') {
            document.getElementById('success-message').style.display = 'block';
            // Clean up URL
            window.history.replaceState({}, '', window.location.pathname);
        }
    }

    // Render a product card
    function renderProductCard(entry, index, type) {
        const url = entry.url || '#';
        const name = entry.name || `${type} ${index + 1}`;
        const image = entry.image || '';
        const price = entry.price_display || '';
        const description = entry.description || '';
        const icon = entry.icon || '';

        return `
            <div class="product-card">
                ${image ? `<img src="${image}" alt="${name}" onerror="this.style.display='none'" class="product-card-image">` : ''}
                <div class="product-card-body">
                    ${icon ? `<div class="product-card-icon">${icon}</div>` : ''}
                    <p class="product-card-name">${name}</p>
                    ${description ? `<p class="product-card-description">${description}</p>` : ''}
                    ${price ? `<p class="product-card-price">${price}</p>` : ''}
                    <a href="${url}" onclick="openCheckoutModal('${url}'); return false;" class="product-card-button">${type === 'Service' ? 'Book Now' : 'Buy Now'}</a>
                </div>
            </div>
        `;
    }

    // Load inventory from local JSON and render
    async function loadInventory() {
        const printsGrid = document.getElementById('prints-grid');
        const servicesGrid = document.getElementById('services-grid');

        try {
            // Add cache-busting parameter
            const response = await fetch('/static/files/store/inventory.json?v=' + Date.now());
            if (!response.ok) {
                printsGrid.innerHTML = '<p class="no-prints">No prints available at this time.</p>';
                servicesGrid.innerHTML = '<p class="no-services">No services available at this time.</p>';
                return;
            }

            const data = await response.json();

            // Render prints
            if (data.prints && data.prints.length > 0) {
                printsGrid.innerHTML = data.prints.map((p, i) => {
                    const entry = (typeof p === 'string') ? { url: p } : p || {};
                    return renderProductCard(entry, i, 'Print');
                }).join('');
            } else {
                printsGrid.innerHTML = '<p class="no-prints">No prints available at this time.</p>';
            }

            // Render services
            if (data.services && data.services.length > 0) {
                servicesGrid.innerHTML = data.services.map((s, i) => {
                    const entry = (typeof s === 'string') ? { url: s } : s || {};
                    return renderProductCard(entry, i, 'Service');
                }).join('');
            } else {
                servicesGrid.innerHTML = '<p class="no-services">No services available at this time.</p>';
            }
        } catch (error) {
            console.error('Failed to load inventory:', error);
            printsGrid.innerHTML = '<p class="error">Failed to load prints. Please try again later.</p>';
            servicesGrid.innerHTML = '<p class="error">Failed to load services. Please try again later.</p>';
        }
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
        checkAccess();
        checkForSuccess();
        loadInventory();

        // Modal close handlers
        document.querySelector('.checkout-modal-close').addEventListener('click', closeCheckoutModal);
        document.querySelector('.checkout-modal-backdrop').addEventListener('click', closeCheckoutModal);
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeCheckoutModal();
            }
        });
    });
</script>
